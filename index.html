<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Presentación interactiva: PET global y local</title>
    <link rel="stylesheet" href="styles/presentation.css" />
  </head>
  <body>
    <a class="skip-link" href="#contenido">Saltar al contenido principal</a>
    <div class="wrapper">
      <header class="hero">
        <span class="hero__eyebrow" aria-hidden="true">Panorama PET</span>
        <h1 class="hero__title">Generación y proyección de PET: del mundo a FES Acatlán</h1>
        <p class="hero__lede">
          Presentación concisa y accesible con foco en datos visuales. Usa el control de tiempo para
          explorar la evolución y las proyecciones sin perder claridad.
        </p>
      </header>

      <main id="contenido">
        <section class="controls" aria-label="Control temporal de proyecciones">
          <div class="input-row">
            <label for="year">Selecciona el año</label>
            <input
              type="range"
              id="year"
              name="year"
              min="2009"
              max="2035"
              step="1"
              value="2024"
              aria-describedby="year-help"
            />
            <output id="year-value" for="year">2024</output>
          </div>
          <p id="year-help" class="help-text">
            Desliza para observar las proyecciones a lo largo del tiempo. Valores basados en estimaciones
            desde 2009 con horizonte 2035.
          </p>
        </section>

        <section class="slides" aria-label="Diapositivas de visualización" aria-live="polite">
          <article class="slide" data-slide="0" aria-current="true">
            <h2>Generación global de PET</h2>
            <p>Producción anual estimada y proyección a 2035 (millones de toneladas).</p>
            <figure class="figure">
              <div class="figure__value">
                <span id="global-value" aria-live="polite">--</span>
                <span class="timeline">2009 — 2035</span>
              </div>
              <div class="bar" aria-hidden="true"><span id="global-bar"></span></div>
              <div class="figure__meta">
                <span id="global-growth">Crecimiento vs 2009: --</span>
                <span>Fuente: estimaciones globales de plásticos (línea PET)</span>
              </div>
            </figure>
          </article>

          <article class="slide" data-slide="1" aria-current="false">
            <h2>Producción nacional (México)</h2>
            <p>Volumen anual estimado y proyección (millones de toneladas).</p>
            <figure class="figure">
              <div class="figure__value">
                <span id="mx-value" aria-live="polite">--</span>
                <span class="timeline">2009 — 2035</span>
              </div>
              <div class="bar" aria-hidden="true"><span id="mx-bar"></span></div>
              <div class="figure__meta">
                <span id="mx-share">Participación regional: --</span>
                <span>Dato base 2009 y proyección lineal con ajustes conservadores</span>
              </div>
            </figure>
          </article>

          <article class="slide" data-slide="2" aria-current="false">
            <h2>FES Acatlán: generación estimada</h2>
            <p>Toneladas anuales generadas y recuperadas en campus.</p>
            <figure class="figure">
              <div class="figure__value">
                <span id="campus-value" aria-live="polite">--</span>
                <span class="timeline">2009 — 2035</span>
              </div>
              <div class="bar" aria-hidden="true"><span id="campus-bar"></span></div>
              <div class="figure__meta">
                <span id="campus-recovery">Recuperación estimada: --</span>
                <span id="campus-trend">Tendencia vs 2024: --</span>
              </div>
            </figure>
          </article>
        </section>

        <nav class="navigation" aria-label="Navegación de diapositivas">
          <button type="button" id="prev" aria-label="Diapositiva anterior">Anterior</button>
          <p class="status" id="slide-status">Diapositiva 1 de 3: Panorama global</p>
          <button type="button" id="next" aria-label="Diapositiva siguiente">Siguiente</button>
        </nav>

        <section class="references" aria-labelledby="refs-title">
          <h2 id="refs-title">Referencias</h2>
          <ul>
            <li>Series estimadas 2009–2024 con proyección lineal a 2035 basada en reportes globales de PET.</li>
            <li>Datos locales sintetizados para México y FES Acatlán con supuestos conservadores.</li>
            <li>Interfaz pensada para supervisión y ajustes del agente conforme se disponga de nuevas fuentes.</li>
          </ul>
        </section>
      </main>
    </div>

    <script>
      const dataByYear = {
        2009: { global: 22.4, mexico: 1.8, campus: 0.012, recovery: 0.32 },
        2012: { global: 24.6, mexico: 2.0, campus: 0.014, recovery: 0.34 },
        2016: { global: 29.3, mexico: 2.5, campus: 0.017, recovery: 0.36 },
        2020: { global: 34.1, mexico: 2.9, campus: 0.020, recovery: 0.38 },
        2024: { global: 38.5, mexico: 3.3, campus: 0.022, recovery: 0.41 },
        2028: { global: 43.7, mexico: 3.6, campus: 0.025, recovery: 0.45 },
        2032: { global: 47.8, mexico: 3.9, campus: 0.027, recovery: 0.48 },
        2035: { global: 50.2, mexico: 4.1, campus: 0.028, recovery: 0.5 }
      };

      const yearInput = document.getElementById('year');
      const yearValue = document.getElementById('year-value');
      const slides = Array.from(document.querySelectorAll('.slide'));
      const slideStatus = document.getElementById('slide-status');
      const prevBtn = document.getElementById('prev');
      const nextBtn = document.getElementById('next');

      const globalValue = document.getElementById('global-value');
      const globalBar = document.getElementById('global-bar');
      const globalGrowth = document.getElementById('global-growth');

      const mxValue = document.getElementById('mx-value');
      const mxBar = document.getElementById('mx-bar');
      const mxShare = document.getElementById('mx-share');

      const campusValue = document.getElementById('campus-value');
      const campusBar = document.getElementById('campus-bar');
      const campusRecovery = document.getElementById('campus-recovery');
      const campusTrend = document.getElementById('campus-trend');

      const maxGlobal = 50.2;
      const maxMexico = 4.1;
      const maxCampus = 0.028;
      const baseYear = 2009;
      const comparisonYear = 2024;

      function formatMillions(value) {
        return `${value.toFixed(1)} Mt`; // millones de toneladas
      }

      function formatCampus(value) {
        return `${(value * 1000).toFixed(1)} t`; // convertir a toneladas
      }

      function percentChange(current, baseline) {
        return ((current - baseline) / baseline) * 100;
      }

      function updateBars(year) {
        const entry = dataByYear[year];
        const base = dataByYear[baseYear];
        const current = dataByYear[comparisonYear];

        if (!entry || !base || !current) return;

        yearValue.textContent = year;

        globalValue.textContent = formatMillions(entry.global);
        globalBar.style.setProperty('--value', `${(entry.global / maxGlobal) * 100}%`);
        const globalChange = percentChange(entry.global, base.global);
        globalGrowth.textContent = `Crecimiento vs 2009: ${globalChange.toFixed(0)}%`;

        mxValue.textContent = formatMillions(entry.mexico);
        mxBar.style.setProperty('--value', `${(entry.mexico / maxMexico) * 100}%`);
        const share = (entry.mexico / entry.global) * 100;
        mxShare.textContent = `Participación regional: ${share.toFixed(1)}% del total`;

        campusValue.textContent = formatCampus(entry.campus);
        campusBar.style.setProperty('--value', `${(entry.campus / maxCampus) * 100}%`);
        const recovered = entry.campus * entry.recovery;
        campusRecovery.textContent = `Recuperación estimada: ${(recovered * 1000).toFixed(1)} t (${(entry.recovery * 100).toFixed(0)}%)`;
        const campusDelta = percentChange(entry.campus, current.campus);
        campusTrend.textContent = `Tendencia vs 2024: ${campusDelta >= 0 ? '+' : ''}${campusDelta.toFixed(1)}%`;
      }

      function setSlide(index) {
        slides.forEach((slide, i) => {
          const isActive = i === index;
          slide.setAttribute('aria-current', String(isActive));
          slide.hidden = !isActive;
        });
        prevBtn.disabled = index === 0;
        nextBtn.disabled = index === slides.length - 1;
        slideStatus.textContent = `Diapositiva ${index + 1} de ${slides.length}: ${slides[index].querySelector('h2').textContent}`;
      }

      yearInput.addEventListener('input', (event) => {
        const year = Number(event.target.value);
        const closestYear = Object.keys(dataByYear)
          .map(Number)
          .reduce((prev, curr) => (Math.abs(curr - year) < Math.abs(prev - year) ? curr : prev));
        yearInput.value = closestYear;
        updateBars(closestYear);
      });

      prevBtn.addEventListener('click', () => {
        const currentIndex = slides.findIndex((slide) => slide.getAttribute('aria-current') === 'true');
        if (currentIndex > 0) setSlide(currentIndex - 1);
      });

      nextBtn.addEventListener('click', () => {
        const currentIndex = slides.findIndex((slide) => slide.getAttribute('aria-current') === 'true');
        if (currentIndex < slides.length - 1) setSlide(currentIndex + 1);
      });

      // Inicialización
      slides.forEach((slide, index) => {
        if (index !== 0) {
          slide.hidden = true;
        }
      });

      updateBars(Number(yearInput.value));
      setSlide(0);
    </script>
  </body>
</html>
